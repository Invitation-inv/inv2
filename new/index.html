<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>دعوة حفل زفاف</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Aref+Ruqaa:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
     font-family: 'Aref Ruqaa', serif;
      background: url("1000218792.jpg") no-repeat center center/cover;
      margin: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
      perspective: 1200px;
      color: rgb(255, 255, 255);
      font-size: 60;
      text-shadow: 2px 2px 2px rgb(175, 169, 169);
    }
     button {
      padding: 30px 30px;
      font-size: 30px;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      margin: 20px;
      background: url("1000218793.jpg") no-repeat center center/cover;
      background-size: cover;
      background-repeat: no-repeat;
      background-color: transparent;
      color: white;
      text-shadow: 2px 2px 2px rgb(158, 158, 158);
    }
       

    .envelope-wrapper {
      width: 800px;
      height: 600px;
      transform-style: preserve-3d;
      transition: transform 4s ease;
    }

    .envelope-wrapper.back {
      transform: rotateY(180deg);

    }

    .envelope-wrapper.back .left,
    .envelope-wrapper.back .right,
    .envelope-wrapper.back .bottom,
    .envelope-wrapper.back .flap,
    .envelope-wrapper.back .card-container,
    .envelope-wrapper.flipping .left,
    .envelope-wrapper.flipping .right,
    .envelope-wrapper.flipping .bottom,
    .envelope-wrapper.flipping .flap,
    .envelope-wrapper.flipping .card-container {
      visibility: hidden;
    }

    .envelope {
      position: relative;
      width: 100%;
      height: 100%;
      background: url("1000218879.png") no-repeat center center/cover;
      border-radius: 6px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.3); /* ظل خفيف للوجه */
      transform-style: preserve-3d;
      cursor: pointer;
    }

    .flap {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 60%;
      background: url("8888.jpg") no-repeat center center/cover;
      clip-path: polygon(0 0, 100% 0, 50% 100%);
      transform-origin: top center;
      transition: transform 0.5s ease;
      z-index: 1;
      box-shadow: 0 5px 10px rgba(0,0,0,0.2);



    }
    
    .flap-text {
      margin-top: 250px; /* مسافة من أعلى المثلث */
      left: -375px;
      font-size: 22px;
      font-weight: bold;
      color: white;
      text-shadow: 0 2px 5px rgba(0,0,0,0.6);
      position: relative;
      z-index: 55; /* النص فوق صورة المثلث */
      pointer-events: none; /* ما يعيق الضغط على المثلث */
    }

    .left, .right, .bottom {
      position: absolute;
      height: 100%;
      z-index: 0;
      background: url("1000218793.jpg") no-repeat center center/cover;
    }

    .left {
      left: 0;
      width: 50%;
      clip-path: polygon(0 0, 0 100%, 100% 50%);
      box-shadow: inset 5px 0 10px rgba(0,0,0,0.2);
    }

    .right {
      right: 0;
      width: 50%;
      clip-path: polygon(100% 0, 100% 100%, 0 50%);
      box-shadow: inset -5px 0 10px rgba(0,0,0,0.2);
    }

    .bottom {
      bottom: 0;
      left: 0;
      width: 100%;
      height: 60%;
      clip-path: polygon(0 100%, 100% 100%, 50% 0);
      box-shadow: inset 0 -5px 10px rgba(0,0,0,0.2);
    }

    .pocket {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 0;
    }

  
    .card-container {
      position: absolute;
      bottom: 0;
      left: 50%;
      transform: translateX(-50%) scale(0.5);
      width: 100%;
      height: 200%;
      opacity: 0;
      z-index: 2;
      transition: transform 4s ease, opacity 2s ease;
      background: url("115948.png") no-repeat center center/cover;
      padding: 10px;
      border-radius: 8px;
      overflow: hidden;
    }
    

    .card {
      position: absolute;
      width: 100%;
      height: 100%;
      box-shadow: 0 8px 25px rgba(0,0,0,0.4);
      border-radius: 20px;
      padding: 30px;
      display: none;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
      transition: transform 5s ease-in-out, opacity 3s ease;
    }

    .card.active {
      display: flex;
    }

    .controls {
      margin-top: 8px;
      text-align: center;
    }

    .controls button {
      padding: 6px 12px;
      margin: 0 5px;
      border: none;
     color: rgb(255, 255, 255);
      text-shadow: 2px 2px 2px rgb(158, 158, 158);
      border-radius: 4px;
      cursor: pointer;
      font-size: 35px;
      background: url("1000218793.jpg") no-repeat center center/cover;

    }
 .envelope.open .flap {
      transform: rotateX(-180deg);
    }

    .envelope.open .card-container {
      bottom: 50%;
      transform: translate(-50%, 50%) scale(1);
      opacity: 1;
    }
     .qr-wrapper {
      display: flex;
      justify-content: center;
      align-items: center;
      margin-top: 20px;
    }
        #countdown {
      display: flex;
      justify-content: center;
      gap: 15px;
      font-family: 'Amiri', serif;
      margin-top: 20px;

    }

    .time-box {
      color: white;
      text-shadow: 2px 2px 2px rgb(158, 158, 158);

      padding: 10px 15px;
      border-radius: 15px;
      text-align: center;
      min-width: 120px;
      background: url("1000218793.jpg") no-repeat center center/cover;

    }

    .time-box span {
      display: block;
      font-size: 50px;
      font-weight: bold;
    }

    .time-label {
      font-size: 30px;
      margin-top: 5px;
      color: rgb(255, 255, 255);
      text-shadow: 2px 2px 2px rgb(158, 158, 158);
;

    }
    .message-box {

      margin: 20px auto;
      padding: 10px;
      border-radius: 12px;
      max-width: 400px;
      text-align: center;
      background: url("1000218793.jpg") no-repeat center center/cover;

    }

    .message-box textarea {
      width: 80%;
      height: 80px;
      border: none;
      outline: none;
      padding: 10px;
      border-radius: 8px;
      resize: none;
      background: white;
      color: #b6c8a2 ;
    }

    .message-box button {
      margin-top: 10px;
      padding: 10px 20px;
      border: none;
      background: white;
      color: black;
      border-radius: 20px;
      cursor: pointer;
    }
    .message-box button:hover {
      background:  black;
    }

    .message-status {
        margin-top: 10px;
        font-weight: bold;
    }
    

  </style>
</head>
<body>
<h1 style="
  position: absolute;
  top: 400px;
  right: 400px;
  z-index: -1;
  font-size: 35px;
  color: white;
  text-shadow: 2px 2px 2px black;
">
  اضغط للفتح
</h1>


  <div class="envelope-wrapper back" id="wrapper">

    <div class="envelope" id="envelope" onclick="openEnvelope()">
      <div class="flap"> </div>      
      <div class="left"></div>
      <div class="right"></div>
      <div class="bottom"> 
        <div >

        </div>
      </div>
      <div class="pocket"></div>
      <div class="card-container" id="cardContainer">

        <!-- الكارد الأولى -->
        <div class="card active">
              <h1 class="fade-in" id="welcomeText" style="animation-delay: 0.5s;font-size: 30px">حيّاك الله، </h1>
    <p></p>
    <h2 class="fade-in" style="animation-delay: 1s;;font-size: 40px;" >دعوة خاصة</h2>
    <p></p>
    <h4 class="fade-in" style="animation-delay: 2s;;font-size: 30px">نتشرف</h4>
    
     
      <div class="fade-in" style="animation-delay: 2.5s; display: flex; justify-content: center; gap: 70px;font-size: 30px">
        <span>السيدة</span>
        <span>السيدة</span>
      </div>

      <div class="fade-in" style="animation-delay: 3s; display: flex; justify-content: center; gap: 70px;font-size: 30px">
        <span>أم أحمد</span>
        <span>أم سمر</span>
      </div>

    <h8 class="fade-in" style="animation-delay: 3.5s;font-size: 30px">بدعوتكم لحضور حفل زفاف </h8>

      <div class="fade-in" style="animation-delay: 4s; display: flex; justify-content: center; gap: 70px;font-size: 30px">
        <span> أحمد</span>
         <span>&</span>
        <span> سمر</span>
      </div>

    <h3 class="fade-in" style="animation-delay: 4.4s;font-size: 30px">بارك الله لهم وبارك عليهما وجمع بينهم في خير</h3>
          <div class="controls">
            <button onclick="nextCard()">التالي</button>
        </div>
      </div>
        <!-- الكارد الثانية -->
       
<div class="card">
  <h2 id="attendanceTitle">هل ستحضر؟</h2>
  <div id="responseButtons" style="margin-top:30px;">
    <button style="padding:6px 12px;font-size: 20px;border-radius:5px;" onclick="confirmAttendance('yes')">نعم، بإذن الله</button>
    <button style="padding:6px 12px;font-size: 20px;border-radius:5px;" onclick="confirmAttendance('no')">لا، أعتذر عن الحضور</button>
  </div>
  <p id="responseMsg" style="margin-top: 20px;"></p>
  <div class="qr-wrapper">
    <div id="qrContainer" style="margin-top: 20px;"></div>
  </div>
  <h1 id="qrNote" style="display: none; font-size: 20px;">📌 استخدم رمز الدخول عند الوصول للقاعة.</h1>
  <h2 id="invitationCount" style="font-size: 14px; display: none;"></h2>
  <button id="downloadBtn" style="display: none; margin-top: 20px;">📥تحميل الدعوة</button>
  <div class="controls">
      <h1>رسالتك للعروسين</h1>

      <div class="message-box">
    <textarea id="message" placeholder=" اكتب تهنئتك"></textarea>
    <button id="sendMessageBtn"> إرسال</button>
    <p id="messageStatus" class="message-status"></p>
     </div>
     
    <button onclick="prevCard()">السابق</button>
    <button onclick="nextCard()">التالي</button>
  </div>
</div>
  <div class="card">
      <img src="1000218877.png"
     style="width: 400px; height: 400px;">

      <div id="countdown">
      <div class="time-box">
        <span id="days">00</span>
        <div class="time-label">يوم</div>
      </div>
      <div class="time-box">
        <span id="hours">00</span>
        <div class="time-label">ساعة</div>
      </div>
      <div class="time-box">
        <span id="minutes">00</span>
        <div class="time-label">دقيقة</div>
      </div>
    </div>
       <hr style="margin: 40px auto; border: 1px solid #fff; width: 80%; opacity: 0.3;" />

     <iframe  src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3624.6707907180357!2d46.837938325403954!3d24.703841178031816!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x3e2fa9d80414dc89%3A0x4c6795d330c79745!2z2YLYtdixINiv2YrYqtmK2YTYsiDZhNmE2KXYrdiq2YHYp9mE2KfYqiDZiNin2YTZhdik2KrZhdix2KfYqg!5e0!3m2!1sar!2ssa!4v1754914876687!5m2!1sar!2ssa" width="200" height="200" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade" ></iframe> 
     <div class="controls">
            <button onclick="prevCard()">السابق</button>
            <button onclick="nextCard()">التالي</button>
        </div> 
  </div>


    </div>
  </div>

  <script>
    const wrapper = document.getElementById('wrapper');
    const envelope = document.getElementById('envelope');
    let flipped = false;
    let opened = false;

    setTimeout(() => {
      wrapper.classList.add('flipping');
      wrapper.classList.remove('back');
      setTimeout(() => {
        wrapper.classList.remove('flipping');
        flipped = true;
      }, 1000); // نفس مدة الانقلاب
    }, 3000);

    function openEnvelope() {
      if (flipped && !opened) {
        envelope.classList.add('open');
        opened = true;
      }
    }

    let currentCard = 0;
    function nextCard() {
      const cards = document.querySelectorAll('.card');
      cards[currentCard].classList.remove('active');
      currentCard = (currentCard + 1) % cards.length;
      cards[currentCard].classList.add('active');
    }

    function prevCard() {
      const cards = document.querySelectorAll('.card');
      cards[currentCard].classList.remove('active');
      currentCard = (currentCard - 1 + cards.length) % cards.length;
      cards[currentCard].classList.add('active');
    }

    

  function toggleMusic() {
    const bgMusic = document.getElementById("bg-music");
    try { bgMusic.paused ? bgMusic.play() : bgMusic.pause(); } catch {}
  }

  const nameParam = new URLSearchParams(location.search).get("name") || "ضيفنا";
  const welcomeText = document.getElementById("welcomeText");
  if (welcomeText) {
    welcomeText.innerText += nameParam;
  }

  const token = new URLSearchParams(location.search).get("token") || "";
  const qrContainer = document.getElementById("qrContainer");
  const responseButtons = document.getElementById("responseButtons");
  const attendanceTitle = document.getElementById("attendanceTitle");
  const responseMsg = document.getElementById("responseMsg");
  const qrNote = document.getElementById("qrNote");
  const downloadBtn = document.getElementById("downloadBtn");
  const invitationCount = document.getElementById("invitationCount");
 
  // Elements for the message box
  const messageTextarea = document.getElementById("message");
  const sendMessageBtn = document.getElementById("sendMessageBtn");
  const messageStatus = document.getElementById("messageStatus");

  // URL for the Google Apps Script
  const scriptURL = "https://script.google.com/macros/s/AKfycbxmecszWPiwb6gVqJpD7XRjavpHOCzrJeqcQjN1ziqLOl-fShjA2kfQi41ZDz_4QZcBoA/exec";


  function confirmAttendance(response) {
    responseMsg.innerText = "⏳ جاري التسجيل...";
    fetch(`${scriptURL}?name=${encodeURIComponent(nameParam)}&token=${token}&response=${response}`)
      .then(res => res.json())
      .then(res => {
        responseButtons.style.display = "none";
        attendanceTitle.style.display = "none";
        responseMsg.innerText = res.message;

        if (res.status === "success" || res.status === "already") {
          showQR(res.qr, res.max);
        } else if (res.status === "declined") {
          qrContainer.innerHTML = "";
          qrNote.style.display = "none";
          invitationCount.style.display = "none";
        }
      })
      .catch(() => {
        responseMsg.innerText = "❌ حدث خطأ أثناء الاتصال بالخادم.";
      });
  }

  function showQR(link, count) {
    qrContainer.innerHTML = "";
    new QRCode(qrContainer, { text: link, width: 200, height: 200 });
    qrNote.style.display = "block";
    invitationCount.style.display = "block";
    invitationCount.innerText = `📩 عدد الدعوات: ${count}`;
    downloadBtn.style.display = "inline-block";
  }

  downloadBtn.onclick = () => {
    const img = qrContainer.querySelector("img");
    if (img) {
      const link = document.createElement("a");
      link.href = img.src;
      link.download = "qr_code.png";
      link.click();
    }
  };

var countDownDate = new Date("sep 20, 2025 20:00:00").getTime();
  var x = setInterval(function() {
    var now = new Date().getTime();
    var distance = countDownDate - now;
    var days = Math.floor(distance / (1000 * 60 * 60 * 24));
    var hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
    var minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
    document.getElementById("days").innerHTML = days;
    document.getElementById("hours").innerHTML = hours;
    document.getElementById("minutes").innerHTML = minutes;
    if (distance < 0) {
      clearInterval(x);
      document.getElementById("countdown").innerHTML = "انتهى الوقت";
    }
  }, 1000);


  window.addEventListener('DOMContentLoaded', () => {
    fetch(`${scriptURL}?token=${token}&check=true`)
      .then(res => res.json())
      .then(res => {
        if (res.status === "already" || res.status === "used") {
          showQR(res.qr, res.max);
          responseButtons.style.display = "none";
          attendanceTitle.style.display = "none";
          responseMsg.innerText = res.message;
        } else if (res.status === "declined") {
          responseButtons.style.display = "none";
          attendanceTitle.style.display = "none";
          responseMsg.innerText = res.message || "نأسف لعدم تمكنك من الحضور.";
        }
      })
      .catch(() => {
        responseMsg.innerText = "❌ لم نتمكن من التحقق من حالتك.";
      });

    sendMessageBtn.addEventListener("click", function() {
        const message = messageTextarea.value.trim();
        if(message === "") {
          messageStatus.style.color = "white";
          messageStatus.innerText = "⚠️ الرجاء كتابة رسالة قبل الإرسال.";
          return;
        }

        messageStatus.style.color = "white";
        messageStatus.innerText = "⏳ جاري إرسال الرسالة...";
        sendMessageBtn.disabled = true;

        fetch(scriptURL, {
            method: "POST",
            body: new URLSearchParams({
                action: "saveMessage",
                message: message,
                token: token
            })
        })
        .then(response => response.text())
        .then(data => {
            if (data.includes("success")) {
                messageStatus.style.color = "white";
                messageStatus.innerText = "✅ تم إرسال الرسالة بنجاح.";
                messageTextarea.value = "";
            } else if (data.includes("already_sent")) {
                messageStatus.style.color = "white";
                messageStatus.innerText = "⚠️ لقد أرسلت رسالة مسبقاً.";
            } else {
                messageStatus.style.color = "white";
                messageStatus.innerText = "❌ حدث خطأ، حاول مرة أخرى.";
            }
            sendMessageBtn.disabled = false;
        })
        .catch(() => {
            messageStatus.style.color = "red";
            messageStatus.innerText = "❌ فشل الاتصال بالخادم.";
            sendMessageBtn.disabled = false;
        });
    });
  });

  </script>

</body>
</html>
